"use strict";var atCopaApp=angular.module("atcopaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","appConfig","mainControllers","teamDirectives","memberDirectives","gameDirectives","authServices","entryServices","gameServices"]);atCopaApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),atCopaApp.run(["$rootScope","$location","$http","TokenHandler","AuthCallbacks","MetaData",function(a,b,c,d,e,f){d.get()?authCallbacks.authConfirmed():c.post("/oauth/authorize",{},{ignoreAuthModule:!0}).success(function(a){d.set(a.access_token),e.authConfirmed()}).error(function(a){d.set(!1),e.authCancelled(a.error)}),a.$on("event:auth-token-error",function(){d.get()?e.authConfirmed():c.post("/oauth/authorize",{},{ignoreAuthModule:!0}).success(function(a){d.set(a.access_token),e.authConfirmed()}).error(function(a){d.set(!1),e.authCancelled(a.error)})}),a.metadata={mainTitle:"Veduca - Assista aos melhores cursos universitários do mundo, em português!",title:"Veduca",description:"Os melhores cursos universitários do Brasil e do mundo ao alcance de todos.","og:url":"http://www.veduca.com.br","og:description":"Os melhores cursos universitários do Brasil e do mundo ao alcance de todos.","og:title":"Veduca","og:image":""},a.$on("$routeChangeSuccess",function(c,d){a.layout=d.locals.layout,a.metadata=f.read(),a.currentPath=b.path()})}]),atCopaApp.factory("MetaData",["$q",function(a){return{metadata:{mainTitle:"Veduca - Assista aos melhores cursos universitários do mundo, em português!",title:"Veduca",description:"Os melhores cursos universitários do Brasil e do mundo ao alcance de todos.","og:url":"http://www.veduca.com.br","og:description":"Os melhores cursos universitários do Brasil e do mundo ao alcance de todos.","og:title":"Veduca","og:type":"website","og:image":""},load:function(b){return this.metadata=b||this.metadata,this.metadata||a.when(this.metadata)},read:function(){return this.metadata||a.when(this.metadata)}}}]),angular.module("appConfig",[]).constant("API_SERVER","localhost:3000");var mainControllers=angular.module("mainControllers",[]);mainControllers.controller("MainCtrl",["$scope","Entry","Game","$filter","$timeout",function(a,b,c,d,e){a.level=0,a.gameLevel=0,a.team_msg="Cadastrar",a.ImageQuestionMessage="Ver imagem";var f,g="Ocorreu um erro. Favor entrar em contato com suporte.",h=function(){a.count>0?(a.count-=1,f=e(h,1e3)):(alert("O tempo terminou."),i())},i=function(){a.level=4};a.showLevel=function(b){b>=2&&!a.team?alert("Você precisa infomar o nome do seu time."):b>=3&&0==a.members.length?alert("Você precisa informar pelo menos 1 jogador."):a.level=b},a.startGame=function(){a.team=null,a.members=[],a.level=1},a.registerTeam=function(){a.team?b.updateTeam(a.team.name).success(function(b){a.team=b,a.level=2,a.team_msg="Atualizar"}).error(function(){alert(g)}):b.addTeam(a.team.name).success(function(b){a.team=b,a.level=2}).error(function(){alert(g)})},a.registerMember=function(){b.addMember(a.newMember,a.team.id).success(function(b){a.members.push(b),a.newMember=""}).error(function(){alert(g)})},a.removeMember=function(c){b.deleteMember(a.members[c].id).success(function(){a.members.splice(c,1)}).error(function(){alert(g)})},a.startPlay=function(){a.level=3,c.getGames().success(function(b){a.tests=b.tests,a.gameLevel=1}).error(function(){alert(g)})},a.filterTest=function(){a.game=a.tests.filter(function(b){return b.id==a.game.id})[0],a.count=a.game.duration,f=e(h,1e3),c.getGameGuideBasic(a.game.id).success(function(b){angular.forEach(b.test_guide_basics,function(a){1==a.test_type.id&&c.getSimpleQuestionAlternatives(a.simple_question.id).success(function(b){a.simple_question.alternatives=b.simple_question_alternatives,a.simple_question.number_corrects=b.simple_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)}),2==a.test_type.id&&c.getGroupQuestionStatement(a.group_question.id).success(function(b){angular.forEach(b.group_question_statements,function(a){c.getGroupQuestionAlternative(a.id).success(function(b){a.alternatives=b.group_question_alternatives,a.number_corrects=b.group_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)})}),a.group_question.statements=b.group_question_statements}).error(function(){alert(g)})}),a.testGuideBasic=b.test_guide_basics,a.gameLevel=2,a.currentQuestion=0,a.textBasicButton="Continuar"}).error(function(){alert(g)})},a.nextStepBasic=function(){a.currentQuestion+=1,a.currentQuestion+1==a.testGuideBasic.length&&(a.textBasicButton="Ir para análise de cenários"),a.currentQuestion==a.testGuideBasic.length&&(a.gameLevel=3)},a.startAnalysis=function(){a.gameLevel=4,c.getGameGuideAnalysis(a.tests[0].id).success(function(b){angular.forEach(b.test_guide_analyses,function(a){c.getGameAnalysisScenario(a.id).success(function(b){angular.forEach(b.test_guide_scenarios,function(a){c.getGameScenariosAp(a.id).success(function(b){b.test_guide_scenario_ap&&(b.test_guide_scenario_ap.group_question?c.getGroupQuestionStatement(b.test_guide_scenario_ap.group_question.id).success(function(b){angular.forEach(b.group_question_statements,function(a){c.getGroupQuestionAlternative(a.id).success(function(b){a.alternatives=b.group_question_alternatives,a.number_corrects=b.group_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)})}),a.ap.group_question.statements=b.group_question_statements}).error(function(){alert(g)}):c.getSimpleQuestionAlternatives(b.test_guide_scenario_ap.simple_question.id).success(function(b){a.ap.simple_question.alternatives=b.simple_question_alternatives,a.ap.simple_question.number_corrects=b.simple_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)})),a.ap=b.test_guide_scenario_ap}).error(function(){alert(g)}),c.getGameScenariosSa(a.id).success(function(b){b.test_guide_scenario_sa&&(b.test_guide_scenario_sa.group_question?c.getGroupQuestionStatement(b.test_guide_scenario_sa.group_question.id).success(function(b){angular.forEach(b.group_question_statements,function(a){c.getGroupQuestionAlternative(a.id).success(function(b){a.alternatives=b.group_question_alternatives,a.number_corrects=b.group_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)})}),a.sa.group_question.statements=b.group_question_statements}).error(function(){alert(g)}):c.getSimpleQuestionAlternatives(b.test_guide_scenario_sa.simple_question.id).success(function(b){a.sa.simple_question.alternatives=b.simple_question_alternatives,a.sa.simple_question.number_corrects=b.simple_question_alternatives.filter(function(a){return a.correct}).length}).error(function(){alert(g)})),a.sa=b.test_guide_scenario_sa}).error(function(){alert(g)})}),a.scenarios=b.test_guide_scenarios}).error(function(){alert(g)})}),a.testGuideAnalyses=b.test_guide_analyses,a.gameAnalysesLevel=1}).error(function(){alert(g)})},a.showPdv=function(b){a.pdv=b,a.gameAnalysesLevel=2,a.currentScenario=0},a.showAnalysis=function(b){a.gameAnalysesLevel=b},a.backPdv=function(){a.gameAnalysesLevel=2,a.currentScenario=0},a.backAnalysis=function(){a.gameAnalysesLevel=1},a.nextScenario=function(){a.currentScenario<a.pdv.scenarios.length-1&&(a.currentScenario+=1)},a.previousScenario=function(){a.currentScenario>0&&(a.currentScenario-=1)},a.finishGame=function(){e.cancel(f),i()},a.showImage=function(){a.imageQuestion?(a.imageQuestion=!1,a.ImageQuestionMessage="Ver imagem"):(a.imageQuestion=!0,a.ImageQuestionMessage="Esconder imagem")}}]),angular.module("teamDirectives",[]).directive("atTeam",function(){return{restrict:"A",templateUrl:"views/team.html",link:function(){}}}),angular.module("memberDirectives",[]).directive("atMembers",function(){return{restrict:"A",templateUrl:"views/members.html",link:function(){}}}),angular.module("gameDirectives",[]).directive("atGame",function(){return{restrict:"A",templateUrl:"views/game.html",link:function(){}}}).directive("atGameFilter",function(){return{restrict:"A",templateUrl:"views/filter_game.html",link:function(){}}}).directive("atGameBasic",function(){return{restrict:"A",templateUrl:"views/basic_game.html",link:function(){}}}).directive("atGameSimpleQuestion",function(){return{restrict:"A",templateUrl:"views/game_simple_question.html",link:function(){}}}).directive("atGameGroupQuestion",function(){return{restrict:"A",templateUrl:"views/game_group_question.html",link:function(){}}}).directive("atGameMessage",function(){return{restrict:"A",templateUrl:"views/game_message.html",link:function(){}}}).directive("atGameInstructionAnalysis",function(){return{restrict:"A",templateUrl:"views/game_instruction_analysis.html",link:function(){}}}).directive("atGameAnalysis",function(){return{restrict:"A",templateUrl:"views/analysis_game.html",link:function(){}}}).directive("atGetPdvs",function(){return{restrict:"A",templateUrl:"views/game_analyses_filter_pdv.html",link:function(){}}}).directive("atShowPdv",function(){return{restrict:"A",templateUrl:"views/game_analyses_show_pdv.html",link:function(){}}}).directive("atShowActionPlan",function(){return{restrict:"A",templateUrl:"views/game_analyses_action_plan.html",link:function(){}}}).directive("atShowScenarioAnalyses",function(){return{restrict:"A",templateUrl:"views/game_analyses_scenario.html",link:function(){}}}).directive("atFinishGame",function(){return{restrict:"A",templateUrl:"views/finish_game.html",link:function(){}}});var entryServices=angular.module("entryServices",[]);entryServices.factory("Entry",["$http","API_SERVER",function(a,b){var c={addTeam:function(c){return a.post("http://"+b+"/teams",{team:{name:c}})},updateTeam:function(c){return a.post("http://"+b+"/teams",{team:{name:c}})},addMember:function(c,d){return a.post("http://"+b+"/members",{member:{name:c,team_id:d}})},deleteMember:function(c){return a.delete("http://"+b+"/members/"+c)}};return c}]);var authServices=angular.module("authServices",["authHelpers"]);authServices.factory("AuthCallbacks",["$rootScope","httpBuffer",function(a,b){return{authConfirmed:function(c,d){var e=d||function(a){return a};a.$emit("event:auth-token-success",c),b.retryAll(e)},authCancelled:function(c,d){b.rejectAll(d),a.$emit("event:auth-token-rejected",c)}}}]),authServices.config(["$httpProvider",function(a){a.defaults.headers.common.Accept="application/vnd.copa+json; version=1",a.interceptors.push(["$rootScope","$q","$injector","httpBuffer","TokenHandler",function(a,b,c,d,e){return{request:function(c){return a.$emit("event:load-start"),e.get()&&!c.ignoreAuthModule&&(c.headers.Authorization="Bearer "+e.get()),c||b.when(c)},response:function(d){var e=e||c.get("$http");return e.pendingRequests.length<1&&a.$emit("event:load-end"),d||b.when(d)},responseError:function(c){var f=b.defer();return 401!==c.status||c.config.ignoreAuthModule||"application/vnd.copa"!==c.data.provider?b.reject(c):(e.set(null),d.append(c.config,f),a.$emit("event:auth-token-error",c),f.promise)}}}])}]);var authHelpers=angular.module("authHelpers",[]);authHelpers.factory("httpBuffer",["$injector",function(a){function b(b,d){function e(a){d.resolve(a)}function f(a){d.reject(a)}c=c||a.get("$http"),c(b).then(e,f)}var c,d=[];return{append:function(a,b){d.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=0;b<d.length;++b)d[b].deferred.reject(a);d=[]},retryAll:function(a){for(var c=0;c<d.length;++c)b(a(d[c].config),d[c].deferred);d=[]}}}]),authHelpers.factory("TokenHandler",[function(){var a={},b=!1;return a.set=function(a){b=a},a.get=function(){return b},a}]);var gameServices=angular.module("gameServices",[]);gameServices.factory("Game",["$http","API_SERVER",function(a,b){var c={getGames:function(){return a.get("http://"+b+"/tests")},getGameGuideBasic:function(c){return a.get("http://"+b+"/tests/"+c+"/test_guide_basics")},getSimpleQuestionAlternatives:function(c){return a.get("http://"+b+"/simple_questions/"+c+"/simple_question_alternatives")},getGroupQuestionStatement:function(c){return a.get("http://"+b+"/group_questions/"+c+"/group_question_statements")},getGroupQuestionAlternative:function(c){return a.get("http://"+b+"/group_question_statements/"+c+"/group_question_alternatives")},getGameGuideAnalysis:function(c){return a.get("http://"+b+"/tests/"+c+"/test_guide_analyses")},getGameAnalysisScenario:function(c){return a.get("http://"+b+"/test_guide_analyses/"+c+"/test_guide_scenarios")},getGameScenariosAp:function(c){return a.get("http://"+b+"/test_guide_scenarios/"+c+"/test_guide_scenario_aps")},getGameScenariosSa:function(c){return a.get("http://"+b+"/test_guide_scenarios/"+c+"/test_guide_scenario_sas")}};return c}]);